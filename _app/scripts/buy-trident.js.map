{"version":3,"sources":["buy-trident.js"],"names":["PRODUCT","objectifyForm","formArray","returnArray","i","length","BuyScreen","formData","variant","address","firstName","lastName","address1","address2","city","country","usState","state","zip","toLowerCase","phone","data","email","notes","Object","assign","billingZip","parseInt","quantity","ccNumber","expDate","split","cvc","variants","selectedVariants","item","startsWith","push","sort","v","ids","options","join","id","undefined","form","serializeArray","getData","getVariant","_calculateShipping","find","show","$","ajax","JSON","stringify","result","val","shipping","toFixed","subtotal","taxes","total","hide","orderForm","url","html","description","optionsHtml","map","o","name","values","append","attr","change","ev","currentTarget","target","selectedIndex","value","removeClass","addClass","validator","calculateShipping","keypress","event","char","String","fromCharCode","which","match","preventDefault","on","relatedTarget","checkValidity","parent","console","log","detail","order","currency","line_items","celery_sku","path","number","window","location","replace","href","text","statusText","responseJSON","setupForm","self","click","submit","runSetupForm","screen","init"],"mappings":"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","file":"buy-trident.js","sourcesContent":["const PRODUCT = '57e9bd02726ecc1100f4204a'; // testproduct\n// const PRODUCT = '5637ca44df92ea03009633b3'; //trident\n\nfunction objectifyForm(formArray) {//serialize data function\n    var returnArray = {};\n    for (var i = 0; i < formArray.length; i++) {\n        returnArray[formArray[i]['name']] = formArray[i]['value'];\n    }\n    return returnArray;\n}\n\nclass BuyScreen {\n\n    getData(formData, variant) {\n        const address = {\n            \"first_name\": formData.firstName,\n            \"last_name\": formData.lastName,\n            \"company\": null,\n            \"line1\": formData.address1,\n            \"line2\": formData.address2,\n            \"city\": formData.city,\n            \"state\": formData.country === 'US' ? formData.usState : formData.state,\n            \"zip\": formData.zip,\n            \"country\": formData.country.toLowerCase(),\n            \"phone\": formData.phone,\n        };\n\n        const data = {\n            \"user_id\": '5637c8d966e9ec03008989ef',\n            \"buyer\": {\n                \"email\": formData.email,\n                \"first_name\": formData.firstName,\n                \"last_name\": formData.lastName,\n                \"phone\": formData.phone,\n                \"notes\": formData.notes,\n            },\n            \"shipping_address\": address,\n            \"billing_address\": Object.assign({} , address, { zip: formData.billingZip }),\n            \"line_items\": [\n                {\n                    // \"product_id\": \"5637ca44df92ea03009633b3\",\n                    \"product_id\": PRODUCT,\n                    \"variant_id\": variant,\n                    \"quantity\": parseInt(formData.quantity)\n                }\n            ],\n            \"payment_source\": {\n                \"card\": {\n                    \"name\": `${formData.firstName} ${formData.lastName}`,\n                    \"number\": formData.ccNumber,\n                    \"exp_month\": formData.expDate.split('/')[0],\n                    \"exp_year\": formData.expDate.split('/')[1],\n                    \"cvc\": formData.cvc\n                }\n            },\n            \"discount_codes\": []\n        }\n        return data;\n    }\n\n    getVariant(formData, variants) {\n\n        let selectedVariants = [];\n        for (const item in formData) {\n            if (item.startsWith('option_')) {\n                selectedVariants.push(formData[item])\n            }\n        }\n        selectedVariants = selectedVariants.sort();\n\n        for(const v of variants) {\n            const ids = v.options.ids.sort();\n            if (ids.join() === selectedVariants.join()) {\n                return v.id;\n            }\n        }\n        return undefined;\n    }\n\n    calculateShipping(form, variants) { \n        const formData = objectifyForm(form.serializeArray())\n        const data = this.getData(formData, this.getVariant(form, variants));\n        return this._calculateShipping(data);\n    }\n\n    async _calculateShipping(data) {    \n        form.find('.loading').show();\n        const result = await $.ajax({\n            \"async\": true,\n            \"crossDomain\": true,\n            \"url\": \"https://wt-f938a32f745f3589d64a35c208dd4c79-0.run.webtask.io/celry-access/calculate-shipping\",\n            \"method\": \"POST\",\n            \"headers\": { \"content-type\": \"application/json\" },\n            \"processData\": false,\n            \"data\": JSON.stringify(data),\n        })\n        form.find('#shipping').val('$' + (result.shipping /100).toFixed(2))\n        form.find('#subtotal').val('$' + (result.subtotal / 100).toFixed(2))\n        form.find('#tax').val('$' + (result.taxes / 100).toFixed(2))\n        form.find('#total').val('$' + (result.total / 100).toFixed(2))\n        form.find('.loading').hide();\n    }\n\n    async setupForm(orderForm) {\n        const result = await $.ajax({\n            url: 'https://wt-f938a32f745f3589d64a35c208dd4c79-0.run.webtask.io/celry-access/products/' + PRODUCT\n        });\n        $('#description').html(result.data.description);\n\n        const optionsHtml = result.data.options.map(o => {\n            return '<div class=\"form-group row\">' +\n                `<label for=\"${o.id}\" class=\"col-2 col-form-label\">${o.name}:</label>` +\n                `<select class=\"form-control form-control-danger col-6\" id=\"option_${o.id}\" name=\"option_${o.id}\" required>` +\n                `<option selected value=\"\" disabled>Select ${o.name}</option>` +\n                    o.values.map(v => {\n                        return `<option value=\"${v.id}\">${v.name}</option>`\n                    }).join('') +\n                '</select>' +\n                '</div>';        \n        }).join('');\n\n        const formData = objectifyForm(orderForm.serializeArray())\n        const data = this.getData(formData, result.data.variants[result.data.variants.length-1].id);\n        this._calculateShipping(data);\n\n        orderForm.find('#options').append(optionsHtml);\n\n        orderForm.find('#country option[value=\"US\"]').attr('selected', 'true');\n        orderForm.find('#country').change(ev => {\n            if (ev.currentTarget.options[ev.target.selectedIndex].value === 'US') {\n                orderForm.find('#usState').removeClass('hidden-xs-up').attr('required', false);\n                orderForm.find('#state').addClass('hidden-xs-up').attr('required', true);\n                \n            }\n            else {\n                orderForm.find('#state').removeClass('hidden-xs-up').attr('required', false);\n                orderForm.find('#usState').addClass('hidden-xs-up').attr('required', false);\n            }\n            orderForm.validator('update');\n            this.calculateShipping(orderForm, result.data.variants);\n        })\n\n        orderForm.find('#options select').change(ev => {\n            this.calculateShipping(orderForm, result.data.variants);\n        });\n\n        orderForm.find('#quantity').change(ev => {\n            this.calculateShipping(orderForm, result.data.variants);\n        });\n\n        orderForm.find('#ccNumber').keypress((event) => {\n            var char = String.fromCharCode(event.which)\n            if (!char.match(/[0-9- ]/)) event.preventDefault();\n        });\n        \n        orderForm.find('#expDate').keypress((event) => {\n            var char = String.fromCharCode(event.which)\n            if (!char.match(/[0-9/]/)) event.preventDefault();\n        });\n\n        orderForm\n            .on('validated.bs.validator', ev => {\n                if (ev.relatedTarget.id === 'expDate' ) {\n                    if (!ev.relatedTarget.checkValidity()) {\n                        $(ev.relatedTarget).parent().addClass('has-danger');\n                        return false;\n                    }\n                    else {\n                        $(ev.relatedTarget).parent().removeClass('has-danger');\n                    }\n\n                }\n            })\n            .on('invalid.bs.validator', ev => {\n                console.log(ev.relatedTarget.id + ' ' + ev.detail);\n\n                // if (ev.relatedTarget.id === 'expDate' && ev.type === 'invalid') {\n                //     ev.relatedTarget.parent().addClass('has-danger')\n                // }\n            })\n\n        const variants = result.data.variants;\n        return variants;\n    };\n\n    async submit() {\n        const { orderForm, variants } = this;\n        orderForm.find('button[type=\"submit\"]').attr('disabled', true);\n        orderForm.find('.submitting').show();\n\n        const formData = objectifyForm(orderForm.serializeArray())\n        const data = this.getData(formData, this.getVariant(formData, this.getVariant(form, variants)));\n        try {\n            const result = await $.ajax({\n                \"async\": true,\n                \"crossDomain\": true,\n                \"url\": \"https://api.trycelery.com/v2/orders/checkout\",\n                \"method\": \"POST\",\n                \"headers\": { \"content-type\": \"application/json\" },\n                \"processData\": false,\n                \"data\": JSON.stringify(data),\n            })\n\n            var order = result.data;\n            var total = order.total / 100;\n            var currency = order.currency;\n            var line_items = order.line_items.map(function (item) { return item.celery_sku; }).join(',');\n            const path = \"?number=\" + order.number +\n                         \"&amount=\" + total + \n                         \"&currency=\" + currency + \n                         \"&line_items=\" + line_items;\n\n            window.location.replace(window.location.href + '../confirmation/' + path);\n        }\n        catch (err) {\n            this.orderForm.find('.alert .title').text(err.statusText);\n            this.orderForm.find('.alert .description').text(err.responseJSON.data);\n            this.orderForm.find('.alert').show();\n            this.orderForm.find('.submitting').hide();\n        }\n\n    }\n\n    async runSetupForm() {\n        this.variants = await this.setupForm(this.orderForm);\n        this.orderForm.validator('update');\n    }\n\n    init() {\n        this.orderForm = $('form#orderForm');\n        const self = this;\n        // this.orderForm.validator().on('submit', (ev) => {\n        this.orderForm.validator().find('button.submit').click((ev) => {\n            ev.preventDefault();\n\n            if (self.variants === undefined) { return; }\n\n            this.orderForm.validator('validate');\n\n            if (!self.orderForm[0].checkValidity()) {\n                return;\n            }\n            else {\n                this.submit();\n            }\n        });\n\n        $('#orderFormContainer').removeClass('invisible');\n        $('#loader-wrapper').addClass('loaded');\n\n        this.runSetupForm();        \n    }\n}\n\n\n(function () {\n    const screen = new BuyScreen();\n    screen.init();\n})()\n"]}