{"version":3,"names":[],"mappings":"","sources":["support.js"],"sourcesContent":["$(document).ready(function () {\n    (function(){\n\n        function mapToObject(items) {\n            var data = {};\n\n            items.forEach(function (item) {\n                var parts = item.name.split('::');\n                var node = data;\n                parts.forEach(function (p) {\n                    delete node.value;\n                    if (!node[p]) { node[p] = { value: item.value } }\n                    node = node[p];\n                })\n            })\n            return data;\n        }\n\n        $.get('https://openrov.zendesk.com/embeddable/ticket_fields?locale=en')\n            .done(function(fieldIdsResult){\n                fieldIdsResult.forEach(\n                    function(field) {\n                        if (field.type == \"text\" && field.title_in_portal ==\"Name\") {\n                            $('#nameInput').data('id', field.id);\n                        }\n                        if (field.id == 24180405) {\n                            var topLevelControl = $('#modal-contactSupport #typeInput');\n                            $('#modal-contactSupport #typeInput').data('id', field.id);\n                            var done = {};\n                            var elements = field.custom_field_options.map(function(option) {\n                                var res = [];\n                                var parts = option.name.split('::');\n                                var breadCrumbs = [];\n                                for(var i = 0; i < parts.length; i++) {\n                                    breadCrumbs.push(parts[i]);\n                                    var joined = breadCrumbs.join(' &gt; ')\n                                    if (!done[joined]) {\n                                        done[joined] = {}\n                                        var value = i === parts.length -1 ? option.value : undefined;\n                                        res.push('<option value=\"' + value + '\">'+ joined +'</option>');\n                                    }\n                                }\n                                return res.join(' ');\n                            })\n                            topLevelControl.append(elements);\n                            topLevelControl.selectHierarchy({ hideOriginal: true, placeholder: ' -- select an option -- ' });\n\n                        }\n                    })\n            })\n\n        var submitedFrom = '\\n\\n------------------\\nSubmitted from: ' + location;\n        $('#modal-contactSupport input[type=submit]').on('click', function(ev) {\n            ev.preventDefault();\n\n            $('#modal-contactSupport #nameInput').parent().toggleClass('has-error', false)\n            $('#modal-contactSupport #emailInput').parent().toggleClass('has-error', false)\n            $('#modal-contactSupport #subjectInput').parent().toggleClass('has-error', false)\n            $('#modal-contactSupport #descriptionInput').parent().toggleClass('has-error', false)\n            $('#modal-contactSupport .drilldown').parent().parent().toggleClass('has-error', false)\n            var error = false;\n            try {\n                var name = $('#nameInput').val();\n                if (name.trim().length == 0) { $('#nameInput').parent().toggleClass('has-error', true); error = true; }\n\n                var email = $('#emailInput').val();\n                if (email.trim().length == 0) { $('#emailInput').parent().toggleClass('has-error', true); error = true; }\n                \n                var subject = $('#subjectInput').val();\n                if (subject.trim().length == 0) { $('#subjectInput').parent().toggleClass('has-error', true); error = true; }\n\n                var description = $('#descriptionInput').val();\n                if (description.trim().length == 0) { $('#descriptionInput').parent().toggleClass('has-error', true); error = true; }\n\n                var type = '';\n                var drillDowns = $('#modal-contactSupport .drilldown');\n\n                $(drillDowns[drillDowns.length -1]).children().toArray().forEach(function(child) {\n                    if (child.selected) {\n                        if (child.value) {\n                            type = child.value\n                        }\n                    }\n                })\n                if (type.trim().length == 0) { $(drillDowns[drillDowns.length - 1]).parent().parent().toggleClass('has-error', true); error = true; }\n\n                var nameId = $('#nameInput').data('id');\n                var typeId = $('#typeInput').data('id');\n                var request = {\n                            \"subject\": subject, \n                            \"tags\": [\"web_widget\"], \n                            \"via_id\": 48, \n                            \"comment\": { \n                                \"body\": description + submitedFrom, \n                            }, \n                            \"requester\": \n                            { \n                                \"name\": name, \n                                \"email\": email, \n                                \"locale_id\": 1 \n                            }, \n                            \"fields\": { \n                            } \n                        }\n                request.fields[nameId] = name;\n                request.fields[typeId] = type;\n\n                if (error) return;\n\n                $('#submitter').prop('disabled', true);\n                $.ajax({\n                    type: \"POST\",\n                    url: 'https://openrov.zendesk.com/api/v2/requests.json',\n                    data: JSON.stringify( {request: request}),\n                    dataType: 'json',\n                    contentType: \"application/json\",\n                    beforeSend: function(xhr) { \n                        xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa(email +'/token:BO4MEQQtX70i6kDJqFmUb5voRNo8OPs2qcyGISBz')); \n                        }\n                }\n                )\n                .done(function(res) {\n                    alert(\"Thank you for your support request. You will hear from us shortly.\");\n                    $('#modal-contactSupport').modal('hide');\n                })\n                .fail(function(err) {\n                    alert('Whoops, something went wrong. Please try again later.')\n                })\n                \n            }\n            catch(err) {\n                console.error(err);\n                return;\n            }\n            if (error) { return }\n\n\n        })\n           \n\n    })()\n});\n"],"file":"../support.js"}