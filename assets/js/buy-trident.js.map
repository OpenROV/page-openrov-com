{"version":3,"sources":["buy-trident.es6"],"names":["PRODUCT","objectifyForm","formArray","returnArray","i","length","BuyScreen","formData","address","firstName","lastName","address1","address2","city","country","usState","toLowerCase","state","zip","phone","data","email","notes","Object","assign","billingZip","variant","parseInt","quantity","ccNumber","expDate","split","cvc","couponCode","variants","selectedVariants","item","startsWith","push","sort","v","ids","options","join","id","undefined","form","serializeArray","getData","_calculateShipping","find","addClass","$","ajax","JSON","stringify","result","text","shipping","toFixed","discount","removeClass","taxes","total","orderForm","url","html","description","idx","optionsHtml","map","values","val","replace","price","prepend","attr","change","ev","currentTarget","target","selectedIndex","value","parent","validator","calculateShipping","itemsOrdered","valueLabel","keypress","event","char","String","fromCharCode","which","match","preventDefault","click","removeAttribute","setAttribute","on","relatedTarget","checkValidity","console","log","detail","show","order","currency","line_items","celery_sku","path","number","window","location","href","statusText","responseJSON","hide","setupForm","self","submit","runSetupForm","screen","init"],"mappings":";;;;;;;;AAAA,IAAMA,UAAU,0BAAhB,C,CAA4C;;AAE5C,SAASC,aAAT,CAAuBC,SAAvB,EAAkC;AAAC;AAC/B,QAAIC,cAAc,EAAlB;AACA,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,UAAUG,MAA9B,EAAsCD,GAAtC,EAA2C;AACvCD,oBAAYD,UAAUE,CAAV,EAAa,MAAb,CAAZ,IAAoCF,UAAUE,CAAV,EAAa,OAAb,CAApC;AACH;AACD,WAAOD,WAAP;AACH;;IAEKG,S;;;;;;;gCAEMC,Q,EAAU;AACd,gBAAMC,UAAU;AACZ,8BAAcD,SAASE,SADX;AAEZ,6BAAaF,SAASG,QAFV;AAGZ,2BAAW,IAHC;AAIZ,yBAASH,SAASI,QAJN;AAKZ,yBAASJ,SAASK,QALN;AAMZ,wBAAQL,SAASM,IANL;AAOZ,yBAASN,SAASO,OAAT,KAAqB,IAArB,GAA4BP,SAASQ,OAAT,CAAiBC,WAAjB,EAA5B,GAA6DT,SAASU,KAPnE;AAQZ,uBAAOV,SAASW,GARJ;AASZ,2BAAWX,SAASO,OAAT,CAAiBE,WAAjB,EATC;AAUZ,yBAAST,SAASY;AAVN,aAAhB;;AAaA,gBAAMC,OAAO;AACT,2BAAW,0BADF;AAET,yBAAS;AACL,6BAASb,SAASc,KADb;AAEL,kCAAcd,SAASE,SAFlB;AAGL,iCAAaF,SAASG,QAHjB;AAIL,6BAASH,SAASY,KAJb;AAKL,6BAASZ,SAASe;AALb,iBAFA;AAST,oCAAoBd,OATX;AAUT,mCAAmBe,OAAOC,MAAP,CAAc,EAAd,EAAkBhB,OAAlB,EAA2B,EAAEU,KAAKX,SAASkB,UAAhB,EAA3B,CAVV;AAWT,8BAAc,CACV;AACI,kCAAczB,OADlB;AAEI,kCAAcO,SAASmB,OAF3B;AAGI,gCAAYC,SAASpB,SAASqB,QAAlB;AAHhB,iBADU,CAXL;AAkBT,kCAAkB;AACd,4BAAQ;AACJ,gCAAWrB,SAASE,SAApB,SAAiCF,SAASG,QADtC;AAEJ,kCAAUH,SAASsB,QAFf;AAGJ,qCAAatB,SAASuB,OAAT,CAAiBC,KAAjB,CAAuB,GAAvB,EAA4B,CAA5B,CAHT;AAIJ,oCAAYxB,SAASuB,OAAT,CAAiBC,KAAjB,CAAuB,GAAvB,EAA4B,CAA5B,CAJR;AAKJ,+BAAOxB,SAASyB;AALZ;AADM,iBAlBT;AA2BT,kCAAkB,CAAEzB,SAAS0B,UAAX;AA3BT,aAAb;AA6BA,mBAAOb,IAAP;AACH;;;mCAEUb,Q,EAAU2B,Q,EAAU;;AAE3B,gBAAIC,mBAAmB,EAAvB;AACA,iBAAK,IAAMC,IAAX,IAAmB7B,QAAnB,EAA6B;AACzB,oBAAI6B,KAAKC,UAAL,CAAgB,SAAhB,CAAJ,EAAgC;AAC5BF,qCAAiBG,IAAjB,CAAsB/B,SAAS6B,IAAT,CAAtB;AACH;AACJ;AACDD,+BAAmBA,iBAAiBI,IAAjB,EAAnB;;AAR2B;AAAA;AAAA;;AAAA;AAU3B,qCAAgBL,QAAhB,8HAA0B;AAAA,wBAAfM,CAAe;;AACtB,wBAAMC,MAAMD,EAAEE,OAAF,CAAUD,GAAV,CAAcF,IAAd,EAAZ;AACA,wBAAIE,IAAIE,IAAJ,OAAeR,iBAAiBQ,IAAjB,EAAnB,EAA4C;AACxC,+BAAOH,EAAEI,EAAT;AACH;AACJ;AAf0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAgB3B,mBAAOC,SAAP;AACH;;;0CAEiBC,I,EAAM;AACpB,gBAAMvC,WAAWN,cAAc6C,KAAKC,cAAL,EAAd,CAAjB;AACA,gBAAM3B,OAAO,KAAK4B,OAAL,CAAazC,QAAb,CAAb;AACA,mBAAO,KAAK0C,kBAAL,CAAwB7B,IAAxB,EAA8B0B,IAA9B,CAAP;AACH;;;;kFAEwB1B,I,EAAM0B,I;;;;;;AAC3BA,qCAAKI,IAAL,CAAU,OAAV,EAAmBC,QAAnB,CAA4B,aAA5B;;uCACqBC,EAAEC,IAAF,CAAO;AACxB,6CAAS,IADe;AAExB,mDAAe,IAFS;AAGxB,2CAAO,8FAHiB;AAIxB,8CAAU,MAJc;AAKxB,+CAAW,EAAE,gBAAgB,kBAAlB,EALa;AAMxB,mDAAe,KANS;AAOxB,4CAAQC,KAAKC,SAAL,CAAenC,IAAf;AAPgB,iCAAP,C;;;AAAfoC,sC;;AASNV,qCAAKI,IAAL,CAAU,WAAV,EAAuBO,IAAvB,CAA4B,MAAM,CAACD,OAAOE,QAAP,GAAkB,GAAnB,EAAwBC,OAAxB,CAAgC,CAAhC,CAAlC;AACA;AACA,oCAAIH,OAAOI,QAAP,GAAkB,CAAtB,EAAyB;AACrBR,sCAAE,qBAAF,EAAyBS,WAAzB,CAAqC,cAArC;AACAT,sCAAE,WAAF,EAAeK,IAAf,CAAoB,MAAM,CAACD,OAAOI,QAAP,GAAkB,GAAnB,EAAwBD,OAAxB,CAAgC,CAAhC,CAA1B;AACH,iCAHD,MAIK;AACDP,sCAAE,qBAAF,EAAyBD,QAAzB,CAAkC,cAAlC;AACH;AACDL,qCAAKI,IAAL,CAAU,MAAV,EAAkBO,IAAlB,CAAuB,MAAM,CAACD,OAAOM,KAAP,GAAe,GAAhB,EAAqBH,OAArB,CAA6B,CAA7B,CAA7B;AACAb,qCAAKI,IAAL,CAAU,QAAV,EAAoBO,IAApB,CAAyB,MAAM,CAACD,OAAOO,KAAP,GAAe,GAAhB,EAAqBJ,OAArB,CAA6B,CAA7B,CAA/B;AACAb,qCAAKI,IAAL,CAAU,OAAV,EAAmBW,WAAnB,CAA+B,aAA/B;;;;;;;;;;;;;;;;;;;oFAGYG,S;;;;;;;;;uCACSZ,EAAEC,IAAF,CAAO;AACxBY,yCAAK,wFAAwFjE;AADrE,iCAAP,C;;;AAAfwD,sC;;AAGNJ,kCAAE,cAAF,EAAkBc,IAAlB,CAAuBV,OAAOpC,IAAP,CAAY+C,WAAnC;AACIC,mC,GAAM,C;AAGJC,2C,GAAcb,OAAOpC,IAAP,CAAYc,QAAZ,CAAqBoC,GAArB,CAAyB,UAAC9B,CAAD,EAAI4B,GAAJ,EAAY;AACrD,2CAAO,6BACH,uCADG,oCAE+B5B,EAAEI,EAFjC,0BAEuDwB,QAAQ,CAAR,GAAY,SAAZ,GAAwB,EAF/E,WAGH,OAHG,GAIH,4DAJG,GAKH5B,EAAEE,OAAF,CAAU6B,MAAV,CAAiBD,GAAjB,CAAqB,eAAO;AAAE,wEAA8BE,IAAIC,OAAJ,CAAY,eAAZ,EAA6B,EAA7B,CAA9B;AAAsE,qCAApG,EAAsG9B,IAAtG,CAA2G,EAA3G,CALG,GAMH,0CANG,GAMyC,CAACH,EAAEkC,KAAF,GAAU,GAAX,EAAiBf,OAAjB,CAAyB,CAAzB,CANzC,GAMsE,OANtE,GAOP,OAPA;AAQH,iCATmB,EASjBhB,IATiB,CASZ,EATY,C;;AAUpBqB,0CAAUd,IAAV,CAAe,UAAf,EAA2ByB,OAA3B,CAAmCN,WAAnC;;AAEM9D,wC,GAAWN,cAAc+D,UAAUjB,cAAV,EAAd,C;;AACjBxC,yCAASO,OAAT,GAAmB,IAAnB;AACMM,oC,GAAO,KAAK4B,OAAL,CAAazC,QAAb,C;;AACb,qCAAK0C,kBAAL,CAAwB7B,IAAxB,EAA8B4C,SAA9B;;AAGAA,0CAAUd,IAAV,CAAe,6BAAf,EAA8C0B,IAA9C,CAAmD,UAAnD,EAA+D,MAA/D;AACAZ,0CAAUd,IAAV,CAAe,UAAf,EAA2B2B,MAA3B,CAAkC,cAAM;AACpC,wCAAIC,GAAGC,aAAH,CAAiBrC,OAAjB,CAAyBoC,GAAGE,MAAH,CAAUC,aAAnC,EAAkDC,KAAlD,KAA4D,IAAhE,EAAsE;AAClElB,kDAAUd,IAAV,CAAe,uBAAf,EAAwCiC,MAAxC,GAAiDtB,WAAjD,CAA6D,cAA7D,EAA6Ee,IAA7E,CAAkF,UAAlF,EAA8F,KAA9F;AACAZ,kDAAUd,IAAV,CAAe,QAAf,EAAyB0B,IAAzB,CAA8B,UAA9B,EAA0C,KAA1C,EAAiDO,MAAjD,GAA0DhC,QAA1D,CAAmE,cAAnE;AAEH,qCAJD,MAKK;AACDa,kDAAUd,IAAV,CAAe,QAAf,EAAyB0B,IAAzB,CAA8B,UAA9B,EAA0C,IAA1C,EAAgDO,MAAhD,GAAyDtB,WAAzD,CAAqE,cAArE;AACAG,kDAAUd,IAAV,CAAe,uBAAf,EAAwCiC,MAAxC,GAAiDhC,QAAjD,CAA0D,cAA1D,EAA0EyB,IAA1E,CAA+E,UAA/E,EAA2F,KAA3F;AACH;AACDZ,8CAAUoB,SAAV,CAAoB,QAApB;AACA,0CAAKC,iBAAL,CAAuBrB,SAAvB;AACH,iCAZD;;AAcAA,0CAAUd,IAAV,CAAe,MAAf,EAAuB2B,MAAvB,CAA8B,cAAM;AAChC,0CAAKQ,iBAAL,CAAuBrB,SAAvB;AACH,iCAFD;AAGAA,0CAAUd,IAAV,CAAe,UAAf,EAA2B2B,MAA3B,CAAkC,cAAM;AACpC,0CAAKQ,iBAAL,CAAuBrB,SAAvB;AACH,iCAFD;AAGAA,0CAAUd,IAAV,CAAe,aAAf,EAA8B2B,MAA9B,CAAqC,cAAM;AACvC,0CAAKQ,iBAAL,CAAuBrB,SAAvB;AACH,iCAFD;;AAIAA,0CAAUd,IAAV,CAAe,WAAf,EAA4B2B,MAA5B,CAAmC,cAAM;AACrCzB,sCAAE,kBAAF,EAAsBK,IAAtB,CAA2BqB,GAAGE,MAAH,CAAUE,KAArC;AACA,wCAAMI,eAAe3D,SAASmD,GAAGE,MAAH,CAAUE,KAAnB,CAArB;AACA,wCAAMK,aAAaD,iBAAiB,CAAjB,GAAqB,MAArB,GAA8B,OAAjD;AACAlC,sCAAE,aAAF,EAAiBK,IAAjB,CAAsB8B,UAAtB;AACA,0CAAKF,iBAAL,CAAuBrB,SAAvB;AACH,iCAND;;AAQAA,0CAAUd,IAAV,CAAe,WAAf,EAA4BsC,QAA5B,CAAqC,UAACC,KAAD,EAAW;AAC5C,wCAAIC,OAAOC,OAAOC,YAAP,CAAoBH,MAAMI,KAA1B,CAAX;AACA,wCAAI,CAACH,KAAKI,KAAL,CAAW,SAAX,CAAL,EAA4BL,MAAMM,cAAN;AAC/B,iCAHD;;AAKA/B,0CAAUd,IAAV,CAAe,UAAf,EAA2BsC,QAA3B,CAAoC,UAACC,KAAD,EAAW;AAC3C,wCAAIC,OAAOC,OAAOC,YAAP,CAAoBH,MAAMI,KAA1B,CAAX;AACA,wCAAI,CAACH,KAAKI,KAAL,CAAW,QAAX,CAAL,EAA2BL,MAAMM,cAAN;AAC9B,iCAHD;;AAKA/B,0CAAUd,IAAV,CAAe,gBAAf,EAAiC8C,KAAjC,CAAuC,cAAM;AACzChC,8CAAUd,IAAV,CAAe,4CAAf,EAA6D,CAA7D,EAAgE+C,eAAhE,CAAgF,SAAhF;AACA7C,sCAAE0B,GAAGE,MAAL,EAAaG,MAAb,GAAsBjC,IAAtB,CAA2B,mCAA3B,EAAgE,CAAhE,EAAmEgD,YAAnE,CAAgF,SAAhF,EAA2F,SAA3F;AACA,0CAAKb,iBAAL,CAAuBrB,SAAvB;AACH,iCAJD;;AAMAA,0CACKmC,EADL,CACQ,oBADR,EAC8B,cAAM;AAC5B,wCAAIrB,GAAGsB,aAAH,CAAiBC,aAAjB,EAAJ,EAAsC;AAClCjD,0CAAE0B,GAAGsB,aAAL,EAAoBjB,MAApB,GAA6BtB,WAA7B,CAAyC,YAAzC,EAAuDA,WAAvD,CAAmE,WAAnE;AACH;AAEJ,iCANL,EAOKsC,EAPL,CAOQ,sBAPR,EAOgC,cAAM;AAC9BG,4CAAQC,GAAR,CAAYzB,GAAGsB,aAAH,CAAiBxD,EAAjB,GAAsB,GAAtB,GAA4BkC,GAAG0B,MAA3C;AACA,wCAAI,CAAC1B,GAAGsB,aAAH,CAAiBC,aAAjB,EAAL,EAAuC;AACnCjD,0CAAE0B,GAAGsB,aAAL,EAAoBjB,MAApB,GAA6BhC,QAA7B,CAAsC,YAAtC,EAAoDA,QAApD,CAA6D,WAA7D;AACH;AACJ,iCAZL;;AAcMjB,wC,GAAWsB,OAAOpC,IAAP,CAAYc,Q;kEACtBA,Q;;;;;;;;;;;;;;;;;;;;;;;;;AAIC8B,yC,GAAwB,I,CAAxBA,S,EAAW9B,Q,GAAa,I,CAAbA,Q;;AACnB8B,0CAAUd,IAAV,CAAe,eAAf,EAAgC0B,IAAhC,CAAqC,UAArC,EAAiD,IAAjD;AACAZ,0CAAUd,IAAV,CAAe,kBAAf,EAAmCuD,IAAnC;;AAEMlG,wC,GAAWN,cAAc+D,UAAUjB,cAAV,EAAd,C;AACX3B,oC,GAAO,KAAK4B,OAAL,CAAazC,QAAb,C;;;uCAEY6C,EAAEC,IAAF,CAAO;AACxB,6CAAS,IADe;AAExB,mDAAe,IAFS;AAGxB,2CAAO,8CAHiB;AAIxB,8CAAU,MAJc;AAKxB,+CAAW,EAAE,gBAAgB,kBAAlB,EALa;AAMxB,mDAAe,KANS;AAOxB,4CAAQC,KAAKC,SAAL,CAAenC,IAAf;AAPgB,iCAAP,C;;;AAAfoC,sC;AAUFkD,qC,GAAQlD,OAAOpC,I;AACf2C,qC,GAAQ2C,MAAM3C,KAAN,GAAc,G;AACtB4C,wC,GAAWD,MAAMC,Q;AACjBC,0C,GAAaF,MAAME,UAAN,CAAiBtC,GAAjB,CAAqB,UAAUlC,IAAV,EAAgB;AAAE,2CAAOA,KAAKyE,UAAZ;AAAyB,iCAAhE,EAAkElE,IAAlE,CAAuE,GAAvE,C;AACXmE,oC,GAAO,aAAaJ,MAAMK,MAAnB,GACT,UADS,GACIhD,KADJ,GAET,YAFS,GAEM4C,QAFN,GAGT,cAHS,GAGQC,U;;;AAErBI,uCAAOC,QAAP,CAAgBzF,MAAhB,CAAuBwF,OAAOC,QAAP,CAAgBC,IAAhB,GAAuB,kBAAvB,GAA4CJ,IAAnE;;;;;;;;AAGA,qCAAK9C,SAAL,CAAed,IAAf,CAAoB,eAApB,EAAqCO,IAArC,CAA0C,aAAI0D,UAA9C;AACA,qCAAKnD,SAAL,CAAed,IAAf,CAAoB,qBAApB,EAA2CO,IAA3C,CAAgD,aAAI2D,YAAJ,CAAiBhG,IAAjE;AACA,qCAAK4C,SAAL,CAAed,IAAf,CAAoB,QAApB,EAA8BuD,IAA9B;AACA,qCAAKzC,SAAL,CAAed,IAAf,CAAoB,eAApB,EAAqC0B,IAArC,CAA0C,UAA1C,EAAsD,KAAtD;AACA,qCAAKZ,SAAL,CAAed,IAAf,CAAoB,kBAApB,EAAwCmE,IAAxC;;;;;;;;;;;;;;;;;;;;;;;;;uCAMkB,KAAKC,SAAL,CAAe,KAAKtD,SAApB,C;;;AAAtB,qCAAK9B,Q;;AACL,qCAAK8B,SAAL,CAAeoB,SAAf,CAAyB,QAAzB;;;;;;;;;;;;;;;;;;+BAGG;AAAA;;AACH,iBAAKpB,SAAL,GAAiBZ,EAAE,gBAAF,CAAjB;AACA,gBAAMmE,OAAO,IAAb;AACA,iBAAKvD,SAAL,CAAeoB,SAAf,GAA2BlC,IAA3B,CAAgC,eAAhC,EAAiD8C,KAAjD,CAAuD,UAAClB,EAAD,EAAQ;AAC3DA,mBAAGiB,cAAH;;AAEA,oBAAIwB,KAAKrF,QAAL,KAAkBW,SAAtB,EAAiC;AAAE;AAAS;;AAE5C,uBAAKmB,SAAL,CAAeoB,SAAf,CAAyB,UAAzB;;AAEA,oBAAI,CAACmC,KAAKvD,SAAL,CAAe,CAAf,EAAkBqC,aAAlB,EAAL,EAAwC;AACpC;AACH,iBAFD,MAGK;AACD,2BAAKmB,MAAL;AACH;AACJ,aAbD;;AAeApE,cAAE,qBAAF,EAAyBS,WAAzB,CAAqC,WAArC;AACAT,cAAE,iBAAF,EAAqBD,QAArB,CAA8B,QAA9B;;AAEA,iBAAKsE,YAAL;AACH;;;;;;AAIL,CAAC,YAAY;AACT,QAAMC,SAAS,IAAIpH,SAAJ,EAAf;AACAoH,WAAOC,IAAP;AACH,CAHD","file":"buy-trident.js","sourcesContent":["const PRODUCT = '5637ca44df92ea03009633b3'; //trident\n\nfunction objectifyForm(formArray) {//serialize data function\n    var returnArray = {};\n    for (var i = 0; i < formArray.length; i++) {\n        returnArray[formArray[i]['name']] = formArray[i]['value'];\n    }\n    return returnArray;\n}\n\nclass BuyScreen {\n\n    getData(formData) {\n        const address = {\n            \"first_name\": formData.firstName,\n            \"last_name\": formData.lastName,\n            \"company\": null,\n            \"line1\": formData.address1,\n            \"line2\": formData.address2,\n            \"city\": formData.city,\n            \"state\": formData.country === 'US' ? formData.usState.toLowerCase() : formData.state,\n            \"zip\": formData.zip,\n            \"country\": formData.country.toLowerCase(),\n            \"phone\": formData.phone,\n        };\n\n        const data = {\n            \"user_id\": '5637c8d966e9ec03008989ef',\n            \"buyer\": {\n                \"email\": formData.email,\n                \"first_name\": formData.firstName,\n                \"last_name\": formData.lastName,\n                \"phone\": formData.phone,\n                \"notes\": formData.notes,\n            },\n            \"shipping_address\": address,\n            \"billing_address\": Object.assign({}, address, { zip: formData.billingZip }),\n            \"line_items\": [\n                {\n                    \"product_id\": PRODUCT,\n                    \"variant_id\": formData.variant,\n                    \"quantity\": parseInt(formData.quantity)\n                }\n            ],\n            \"payment_source\": {\n                \"card\": {\n                    \"name\": `${formData.firstName} ${formData.lastName}`,\n                    \"number\": formData.ccNumber,\n                    \"exp_month\": formData.expDate.split('/')[0],\n                    \"exp_year\": formData.expDate.split('/')[1],\n                    \"cvc\": formData.cvc\n                }\n            },\n            \"discount_codes\": [ formData.couponCode ]\n        }\n        return data;\n    }\n\n    getVariant(formData, variants) {\n\n        let selectedVariants = [];\n        for (const item in formData) {\n            if (item.startsWith('option_')) {\n                selectedVariants.push(formData[item])\n            }\n        }\n        selectedVariants = selectedVariants.sort();\n\n        for (const v of variants) {\n            const ids = v.options.ids.sort();\n            if (ids.join() === selectedVariants.join()) {\n                return v.id;\n            }\n        }\n        return undefined;\n    }\n\n    calculateShipping(form) {\n        const formData = objectifyForm(form.serializeArray())\n        const data = this.getData(formData);\n        return this._calculateShipping(data, form);\n    }\n\n    async _calculateShipping(data, form) {\n        form.find('tfoot').addClass('calculating');\n        const result = await $.ajax({\n            \"async\": true,\n            \"crossDomain\": true,\n            \"url\": \"https://wt-f938a32f745f3589d64a35c208dd4c79-0.run.webtask.io/celry-access/calculate-shipping\",\n            \"method\": \"POST\",\n            \"headers\": { \"content-type\": \"application/json\" },\n            \"processData\": false,\n            \"data\": JSON.stringify(data),\n        })\n        form.find('#shipping').text('$' + (result.shipping / 100).toFixed(2))\n        // form.find('#subtotal').val('$' + (result.subtotal / 100).toFixed(2))\n        if (result.discount > 0) {\n            $('#discount-container').removeClass('hidden-xs-up');\n            $('#discount').text('$' + (result.discount / 100).toFixed(2))\n        }\n        else {\n            $('#discount-container').addClass('hidden-xs-up');\n        }\n        form.find('#tax').text('$' + (result.taxes / 100).toFixed(2))\n        form.find('#total').text('$' + (result.total / 100).toFixed(2))\n        form.find('tfoot').removeClass('calculating');\n    }\n\n    async setupForm(orderForm) {\n        const result = await $.ajax({\n            url: 'https://wt-f938a32f745f3589d64a35c208dd4c79-0.run.webtask.io/celry-access/products/' + PRODUCT\n        });\n        $('#description').html(result.data.description);\n        let idx = 0;\n\n\n        const optionsHtml = result.data.variants.map((v, idx) => {\n            return '<tr class=\"product-row\">' +\n                '<td class=\"product-selector product\">' +\n                    `<input type=\"radio\" value=\"${v.id}\" name=\"variant\" ${idx === 0 ? 'checked' : ''}>` +\n                '</td>' +\n                '<td class=\"product-info product hideOnMobile\">Trident</td>' +\n                v.options.values.map(val => { return `<td class=\"product\">${val.replace(/\\([+$0-9].*\\)/, '')}</td>`}).join('') +\n                '<td class=\"text-right product pricing\">$'+ (v.price / 100 ).toFixed(2)+ '</td>' +\n            '</tr>';\n        }).join('');\n        orderForm.find('#options').prepend(optionsHtml);\n\n        const formData = objectifyForm(orderForm.serializeArray())\n        formData.country = 'us';\n        const data = this.getData(formData);\n        this._calculateShipping(data, orderForm);\n\n\n        orderForm.find('#country option[value=\"US\"]').attr('selected', 'true');\n        orderForm.find('#country').change(ev => {\n            if (ev.currentTarget.options[ev.target.selectedIndex].value === 'US') {\n                orderForm.find('.select-wrap #usState').parent().removeClass('hidden-xs-up').attr('required', false);\n                orderForm.find('#state').attr('required', false).parent().addClass('hidden-xs-up')\n\n            }\n            else {\n                orderForm.find('#state').attr('required', true).parent().removeClass('hidden-xs-up');\n                orderForm.find('.select-wrap #usState').parent().addClass('hidden-xs-up').attr('required', false);\n            }\n            orderForm.validator('update');\n            this.calculateShipping(orderForm);\n        })\n\n        orderForm.find('#zip').change(ev => {\n            this.calculateShipping(orderForm);\n        });\n        orderForm.find('#usState').change(ev => {\n            this.calculateShipping(orderForm);\n        });\n        orderForm.find('#couponCode').change(ev => {\n            this.calculateShipping(orderForm);\n        });\n\n        orderForm.find('#quantity').change(ev => {\n            $('#quantityOrdered').text(ev.target.value);\n            const itemsOrdered = parseInt(ev.target.value);\n            const valueLabel = itemsOrdered === 1 ? 'item' : 'items';\n            $('#itemsLabel').text(valueLabel);\n            this.calculateShipping(orderForm);\n        });\n\n        orderForm.find('#ccNumber').keypress((event) => {\n            var char = String.fromCharCode(event.which)\n            if (!char.match(/[0-9- ]/)) event.preventDefault();\n        });\n\n        orderForm.find('#expDate').keypress((event) => {\n            var char = String.fromCharCode(event.which)\n            if (!char.match(/[0-9/]/)) event.preventDefault();\n        });\n\n        orderForm.find('tr.product-row').click(ev => {\n            orderForm.find('input[type=radio][name=\"variant\"][checked]')[0].removeAttribute('checked');\n            $(ev.target).parent().find('input[type=radio][name=\"variant\"]')[0].setAttribute('checked', 'checked');\n            this.calculateShipping(orderForm);\n        });\n\n        orderForm\n            .on('valid.bs.validator', ev => {\n                if (ev.relatedTarget.checkValidity()) {\n                    $(ev.relatedTarget).parent().removeClass('has-danger').removeClass('has-error');\n                }\n\n            })\n            .on('invalid.bs.validator', ev => {\n                console.log(ev.relatedTarget.id + ' ' + ev.detail);\n                if (!ev.relatedTarget.checkValidity()) {\n                    $(ev.relatedTarget).parent().addClass('has-danger').addClass('has-error');\n                }\n            })\n\n        const variants = result.data.variants;\n        return variants;\n    };\n\n    async submit() {\n        const { orderForm, variants } = this;\n        orderForm.find('button.submit').attr('disabled', true);\n        orderForm.find('#orderProcessing').show();\n\n        const formData = objectifyForm(orderForm.serializeArray())\n        const data = this.getData(formData);\n        try {\n            const result = await $.ajax({\n                \"async\": true,\n                \"crossDomain\": true,\n                \"url\": \"https://api.trycelery.com/v2/orders/checkout\",\n                \"method\": \"POST\",\n                \"headers\": { \"content-type\": \"application/json\" },\n                \"processData\": false,\n                \"data\": JSON.stringify(data),\n            })\n\n            var order = result.data;\n            var total = order.total / 100;\n            var currency = order.currency;\n            var line_items = order.line_items.map(function (item) { return item.celery_sku; }).join(',');\n            const path = \"?number=\" + order.number +\n                \"&amount=\" + total +\n                \"&currency=\" + currency +\n                \"&line_items=\" + line_items;\n\n            window.location.assign(window.location.href + '../confirmation/' + path);\n        }\n        catch (err) {\n            this.orderForm.find('.alert .title').text(err.statusText);\n            this.orderForm.find('.alert .description').text(err.responseJSON.data);\n            this.orderForm.find('.alert').show();\n            this.orderForm.find('button.submit').attr('disabled', false);\n            this.orderForm.find('#orderProcessing').hide();\n        }\n\n    }\n\n    async runSetupForm() {\n        this.variants = await this.setupForm(this.orderForm);\n        this.orderForm.validator('update');\n    }\n\n    init() {\n        this.orderForm = $('form#orderForm');\n        const self = this;\n        this.orderForm.validator().find('button.submit').click((ev) => {\n            ev.preventDefault();\n\n            if (self.variants === undefined) { return; }\n\n            this.orderForm.validator('validate');\n\n            if (!self.orderForm[0].checkValidity()) {\n                return;\n            }\n            else {\n                this.submit();\n            }\n        });\n\n        $('#orderFormContainer').removeClass('invisible');\n        $('#loader-wrapper').addClass('loaded');\n\n        this.runSetupForm();\n    }\n}\n\n\n(function () {\n    const screen = new BuyScreen();\n    screen.init();\n})()\n"]}