{"version":3,"sources":["buy-trident.es6"],"names":["PRODUCT","objectifyForm","formArray","returnArray","i","length","BuyScreen","formData","address","firstName","lastName","address1","address2","city","country","usState","toLowerCase","state","zip","phone","data","email","notes","Object","assign","billingZip","variant","parseInt","quantity","ccNumber","expDate","split","cvc","couponCode","variants","selectedVariants","item","startsWith","push","sort","v","ids","options","join","id","undefined","form","serializeArray","getData","_calculateShipping","find","show","$","ajax","JSON","stringify","result","text","shipping","toFixed","discount","removeClass","taxes","total","hide","orderForm","url","html","description","idx","optionsHtml","map","values","val","replace","price","prepend","attr","change","ev","currentTarget","target","selectedIndex","value","parent","addClass","validator","calculateShipping","keypress","event","char","String","fromCharCode","which","match","preventDefault","click","removeAttribute","setAttribute","on","relatedTarget","checkValidity","console","log","detail","error","order","currency","line_items","celery_sku","path","number","window","location","href","statusText","responseJSON","setupForm","self","submit","runSetupForm","screen","init"],"mappings":"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","file":"buy-trident.js","sourcesContent":["const PRODUCT = '5637ca44df92ea03009633b3'; //trident\n\nfunction objectifyForm(formArray) {//serialize data function\n    var returnArray = {};\n    for (var i = 0; i < formArray.length; i++) {\n        returnArray[formArray[i]['name']] = formArray[i]['value'];\n    }\n    return returnArray;\n}\n\nclass BuyScreen {\n\n    getData(formData) {\n        const address = {\n            \"first_name\": formData.firstName,\n            \"last_name\": formData.lastName,\n            \"company\": null,\n            \"line1\": formData.address1,\n            \"line2\": formData.address2,\n            \"city\": formData.city,\n            \"state\": formData.country === 'US' ? formData.usState.toLowerCase() : formData.state,\n            \"zip\": formData.zip,\n            \"country\": formData.country.toLowerCase(),\n            \"phone\": formData.phone,\n        };\n\n        const data = {\n            \"user_id\": '5637c8d966e9ec03008989ef',\n            \"buyer\": {\n                \"email\": formData.email,\n                \"first_name\": formData.firstName,\n                \"last_name\": formData.lastName,\n                \"phone\": formData.phone,\n                \"notes\": formData.notes,\n            },\n            \"shipping_address\": address,\n            \"billing_address\": Object.assign({}, address, { zip: formData.billingZip }),\n            \"line_items\": [\n                {\n                    \"product_id\": PRODUCT,\n                    \"variant_id\": formData.variant,\n                    \"quantity\": parseInt(formData.quantity)\n                }\n            ],\n            \"payment_source\": {\n                \"card\": {\n                    \"name\": `${formData.firstName} ${formData.lastName}`,\n                    \"number\": formData.ccNumber,\n                    \"exp_month\": formData.expDate.split('/')[0],\n                    \"exp_year\": formData.expDate.split('/')[1],\n                    \"cvc\": formData.cvc\n                }\n            },\n            \"discount_codes\": [ formData.couponCode ]\n        }\n        return data;\n    }\n\n    getVariant(formData, variants) {\n\n        let selectedVariants = [];\n        for (const item in formData) {\n            if (item.startsWith('option_')) {\n                selectedVariants.push(formData[item])\n            }\n        }\n        selectedVariants = selectedVariants.sort();\n\n        for (const v of variants) {\n            const ids = v.options.ids.sort();\n            if (ids.join() === selectedVariants.join()) {\n                return v.id;\n            }\n        }\n        return undefined;\n    }\n\n    calculateShipping(form) {\n        const formData = objectifyForm(form.serializeArray())\n        const data = this.getData(formData);\n        return this._calculateShipping(data, form);\n    }\n\n    async _calculateShipping(data, form) {\n        form.find('.loading').show();\n        const result = await $.ajax({\n            \"async\": true,\n            \"crossDomain\": true,\n            \"url\": \"https://wt-f938a32f745f3589d64a35c208dd4c79-0.run.webtask.io/celry-access/calculate-shipping\",\n            \"method\": \"POST\",\n            \"headers\": { \"content-type\": \"application/json\" },\n            \"processData\": false,\n            \"data\": JSON.stringify(data),\n        })\n        form.find('#shipping').text('$' + (result.shipping / 100).toFixed(2))\n        // form.find('#subtotal').val('$' + (result.subtotal / 100).toFixed(2))\n        if (result.discount > 0) {\n            $('#discount-container').removeClass('hidden-xs-up');\n            $('#discount').text('$' + (result.discount / 100).toFixed(2))\n        }\n        form.find('#tax').text('$' + (result.taxes / 100).toFixed(2))\n        form.find('#total').text('$' + (result.total / 100).toFixed(2))\n        form.find('.loading').hide();\n    }\n\n    async setupForm(orderForm) {\n        const result = await $.ajax({\n            url: 'https://wt-f938a32f745f3589d64a35c208dd4c79-0.run.webtask.io/celry-access/products/' + PRODUCT\n        });\n        $('#description').html(result.data.description);\n        let idx = 0;\n\n\n        const optionsHtml = result.data.variants.map((v, idx) => {\n            return '<tr class=\"product-row\">' +\n                '<td class=\"product-selector product\">' +\n                    `<input type=\"radio\" value=\"${v.id}\" name=\"variant\" ${idx === 0 ? 'checked' : ''}>` +\n                '</td>' +\n                '<td class=\"product-info product\">Trident</td>' +\n                v.options.values.map(val => { return `<td class=\"product\">${val.replace(/\\([+$0-9].*\\)/, '')}</td>`}).join('') +\n                '<td class=\"text-right product pricing\">$'+ (v.price / 100 ).toFixed(2)+ '</td>' +\n            '</tr>';\n        }).join('');\n        orderForm.find('#options').prepend(optionsHtml);\n\n        const formData = objectifyForm(orderForm.serializeArray())\n        formData.country = 'us';\n        const data = this.getData(formData);\n        this._calculateShipping(data, orderForm);\n\n\n        orderForm.find('#country option[value=\"US\"]').attr('selected', 'true');\n        orderForm.find('#country').change(ev => {\n            if (ev.currentTarget.options[ev.target.selectedIndex].value === 'US') {\n                orderForm.find('.select-wrap #usState').parent().removeClass('hidden-xs-up').attr('required', false);\n                orderForm.find('#state').addClass('hidden-xs-up').attr('required', true);\n\n            }\n            else {\n                orderForm.find('#state').removeClass('hidden-xs-up').attr('required', false);\n                orderForm.find('.select-wrap #usState').parent().addClass('hidden-xs-up').attr('required', false);\n            }\n            orderForm.validator('update');\n            this.calculateShipping(orderForm);\n        })\n\n        orderForm.find('#zip').change(ev => {\n            this.calculateShipping(orderForm);\n        });\n        orderForm.find('#usState').change(ev => {\n            this.calculateShipping(orderForm);\n        });\n        orderForm.find('#couponCode').change(ev => {\n            this.calculateShipping(orderForm);\n        });\n\n        orderForm.find('#quantity').change(ev => {\n            $('#quantityOrdered').text(ev.target.value);\n            this.calculateShipping(orderForm);\n        });\n\n        orderForm.find('#ccNumber').keypress((event) => {\n            var char = String.fromCharCode(event.which)\n            if (!char.match(/[0-9- ]/)) event.preventDefault();\n        });\n\n        orderForm.find('#expDate').keypress((event) => {\n            var char = String.fromCharCode(event.which)\n            if (!char.match(/[0-9/]/)) event.preventDefault();\n        });\n\n        orderForm.find('tr.product-row').click(ev => {\n            orderForm.find('input[type=radio][name=\"variant\"][checked]')[0].removeAttribute('checked');\n            $(ev.target).parent().find('input[type=radio][name=\"variant\"]')[0].setAttribute('checked', 'checked');\n            this.calculateShipping(orderForm);\n        });\n\n        orderForm\n            .on('validated.bs.validator', ev => {\n                if (ev.relatedTarget.id === 'expDate') {\n                    if (!ev.relatedTarget.checkValidity()) {\n                        $(ev.relatedTarget).parent().addClass('has-danger');\n                        return false;\n                    }\n                    else {\n                        $(ev.relatedTarget).parent().removeClass('has-danger');\n                    }\n\n                }\n            })\n            .on('invalid.bs.validator', ev => {\n                console.log(ev.relatedTarget.id + ' ' + ev.detail);\n\n                // if (ev.relatedTarget.id === 'expDate' && ev.type === 'invalid') {\n                //     ev.relatedTarget.parent().addClass('has-danger')\n                // }\n            })\n\n        const variants = result.data.variants;\n        return variants;\n    };\n\n    async submit() {\n        const { orderForm, variants } = this;\n        orderForm.find('button[type=\"submit\"]').attr('disabled', true);\n        orderForm.find('.submitting').show();\n\n        const formData = objectifyForm(orderForm.serializeArray())\n        //TODO const data = this.getData(formData, this.getVariant(formData, this.getVariant(form, variants)));\n        console.error('TODO');\n        try {\n            const result = await $.ajax({\n                \"async\": true,\n                \"crossDomain\": true,\n                \"url\": \"https://api.trycelery.com/v2/orders/checkout\",\n                \"method\": \"POST\",\n                \"headers\": { \"content-type\": \"application/json\" },\n                \"processData\": false,\n                \"data\": JSON.stringify(data),\n            })\n\n            var order = result.data;\n            var total = order.total / 100;\n            var currency = order.currency;\n            var line_items = order.line_items.map(function (item) { return item.celery_sku; }).join(',');\n            const path = \"?number=\" + order.number +\n                \"&amount=\" + total +\n                \"&currency=\" + currency +\n                \"&line_items=\" + line_items;\n\n            window.location.replace(window.location.href + '../confirmation/' + path);\n        }\n        catch (err) {\n            this.orderForm.find('.alert .title').text(err.statusText);\n            this.orderForm.find('.alert .description').text(err.responseJSON.data);\n            this.orderForm.find('.alert').show();\n            this.orderForm.find('.submitting').hide();\n        }\n\n    }\n\n    async runSetupForm() {\n        this.variants = await this.setupForm(this.orderForm);\n        this.orderForm.validator('update');\n    }\n\n    init() {\n        this.orderForm = $('form#orderForm');\n        const self = this;\n        // this.orderForm.validator().on('submit', (ev) => {\n        this.orderForm.validator().find('button.submit').click((ev) => {\n            ev.preventDefault();\n\n            if (self.variants === undefined) { return; }\n\n            this.orderForm.validator('validate');\n\n            if (!self.orderForm[0].checkValidity()) {\n                return;\n            }\n            else {\n                this.submit();\n            }\n        });\n\n        $('#orderFormContainer').removeClass('invisible');\n        $('#loader-wrapper').addClass('loaded');\n\n        this.runSetupForm();\n    }\n}\n\n\n(function () {\n    const screen = new BuyScreen();\n    screen.init();\n})()\n"]}